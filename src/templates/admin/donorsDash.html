<!doctype html>
<html lang="en">
  <head>
    <title>NGO ADMIN</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href=" {{ url_for ( 'static', filename='admin/css/fontawesome-free-5.0.1/css/fontawesome-all.css') }}   ">
    <link rel="stylesheet" href="{{ url_for ( 'static', filename='admin/css/styles.css') }}">
  </head>
  <body>
    <nav class="navbar navbar-expand-md fixed-top bg-nav">
      <div class="container-fluid">
        <!-- <a class="navbar-brand" href="#">App Name</a> -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
          aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav me-auto mx-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="#">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('admin.index_dashboard') }}">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('admin.mission_dashboard') }}">Mission</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('admin.financial_dashboard') }}">Financial Report</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('admin.partners_dashboard') }}">Partners</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('admin.forums_dashboard') }}">Forums</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('admin.aidr_dashboard')}}">Artists</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('admin.donors_dashboard') }}">Donors</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main class="flex-shrink-0">
      <div class="container">
        <h2 class="mt-5 dash-title">Donors Page</h2>
      </div>
    </main>

    <div class="container mt-5">
      <div class="row">
        <div class="col-md-12">
          <!-- image slider -->
          <div class="column">
            <div id="slide-wrapper" >
              <img id="slideLeft" class="arrow" src="{{ url_for('static', filename='admin/img/arrow-left.png')}}">
              <div id="slider">
                <img class="thumbnail active" src="{{ url_for('static', filename='admin/img/oyinkan_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/soyemi_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/oyinkan_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/soyemi_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/soyemi_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/oyinkan_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/soyemi_pics.png')}}">
                <img class="thumbnail" src="{{ url_for('static', filename='admin/img/person_8.jpg')}}">
              </div>
              <img id="slideRight" class="arrow" src="{{ url_for('static', filename='admin/img/arrow-right.png')}}">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container mt-5">
      <div class="row" id="dcont">
        <div class="d-md-flex justify-content-end flex-md-row d-block mb-10 pb-5">
          <button type="button" class="btn btn-dark float-right" data-bs-toggle="modal"
            data-bs-target="#profileModalAdd" style="width: 200px"> <i class="fas fa-plus"></i> Add new team member
          </button>
        </div>
      </div>
    </div>
    <div id = "profileModals">
      <!--MODALS--> 
      <div class="modal fade" id="profileModalAdd" tabindex="-1" 
        aria-labelledby="profileModalLabelAdd" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="container">
                <div class="signIn-inputs">
                  <form id="addFile" enctype="multipart/form-data">
                    <!-- <div class="form-group mb-3">
                      <input type="text" class="form-control mb-3" id="addLogo" placeholder="add donor's logo link here">
                    </div> -->
                    <div class="form-group mb-3">
                      <input type="text" class="form-control mb-3" id="addName" placeholder="add donor's name here">
                    </div>
                    <div class="form-group mb-3">
                      <textarea name="" class="form-control" id="addProfile" cols="30" rows="10" placeholder="add donor's profile here"></textarea>
                    </div>
                    <div class="form-group mb-3">
                      <input type="url" class="form-control mb-3" id="addLink" placeholder="add donor's website link here">
                    </div>
                    <div class="form-group mb-3">
                      <!-- <button  type="button" onclick="document.getElementById('addFile').click()">
                        add Image
                      </button> -->
                      <button id="addFileBtn">add donor's logo</button>
                      <input type="file" name="file" id="addFiles" onchange="startUpload(this.files[0], 0)" accept="image/*" style="display: none;" >
                    </div>
                    <div class=" text-center">
                      <button onclick="SubmitPost()" type="button" id="submit-btn0" class="btn btn-lg btn-modal"
                        disabled>PUBLISH</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="{{ url_for('static' , filename='admin/js/jquery-3.6.0.min.js' ) }} "></script>
    <script src="{{ url_for('static' , filename='admin/js/popper.js' ) }}     "></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous">
    </script>
    <script src="{{ url_for('static' , filename='admin/js/main.js' ) }}    "></script>
    <script>
      // DONORS ROUTE
      // GET DONORS
      const dRoute = "{{ url_for('api.donors') }}";
      // ADD DONOR
      const addDonor = (logo_url, name, profile, website_url) => {
        axios.post(dRoute, { logo_url, name, profile, website_url })
        .then(function(response) {
          console.log(response.data);
          location.reload();
        })
        .catch(function(error) {
          console.log(error);
        })
      }

      // DONOR WITH ID
      const getDonorById = (id) => {
        axios.get(`${dRoute}/${id}`)
        .then(function(response) {
          console.log(response);
        })
        .catch(function(error) {
          console.log(error);
        })
      }
      // UPDATE DONOR BY ID
      const updateDonorById = (id, logo_url, name, profile, website_url) => {
        axios.put(`${dRoute}/${id}`, { logo_url, name, profile, website_url })
        .then(function(response) {
          console.log(response);
          location.reload();
        })
        .catch(function(error) {
          console.log(error);
        })
      }
      // DELETE DONOR BY ID
      const deleteDonorById = (id) => {
        axios.delete(`${dRoute}/${id}`)
        .then(function(response) {
          console.log(response);
          location.reload();
        })
        .catch(function(error) {
          console.log(error);
        })
      }
      let amnt, profileModalNo, tId;
      var fileUrl;
      // UPLOAD API accepts Image file
      function upload(data, id) {
        axios.post("{{ url_for('api.upload') }}", data)
        .then(function(response) {
          //console.log('tried uploaded file', response);
          $(`#${'submit-btn'+id}`). removeAttr('disabled');    
          fileUrl =  response.data.file_url;
          console.log(fileUrl);
        })
        .catch(function (error) {
          console.log(error.response);
        })
      }

      // Donor PUT REQUEST
      //EVENT LISTENER FOR THE DATA
      // START UPLOAD
      function startUpload(file, id) {
        console.log('files start');
        //console.log(file);
        //console.log(i);
        //console.log(file);
        if(file) {
          // let result;
          // var reader = new FileReader();
          // reader.onload = function (e) {
            //   result = e.target.result;
            // $(`#${'wrapperImg'+id}`)
            // .attr('src')
            //   ;
          // };
          // reader.readAsDataURL(file);
          // let im = $(`${'wrapperImg'+i}`);
          // im.src = imageUrl;
          // let formElem = document.getElementById(`'${form}'`);
          let d = new FormData();
          d.append('file', file);
          console.log(d);        
          upload(d, id);
        };                      
      }
      $("form").submit(function(e) {
        e.preventDefault();
      });
      function Submit(id) {
        console.log(id);
        console.log(fileUrl);
        const name = $(`#${"name"+id}`).value;
        const logo_url = fileUrl;
        const profile = $(`#${"profile"+id}`).value;
        const website_url = $(`#${"link"+id}`).value;
        updateDonorById(id, logo_url, name, profile, website_url);
      }

      // Donor POST REQUEST
      // ADD DONOR
      let oin = document.querySelector('#addFiles');
      document.querySelector('#addFileBtn').onclick = function() {
        console.log('clicked');
        oin.click();
      }

      //SUBMIT FORM
      function SubmitPost() {
        console.log(fileUrl);
        const name = document.querySelector("#addName").value;
        const logo_url = fileUrl;
        const profile = document.querySelector("#addProfile").value;
        const website_url = document.querySelector("#addLink").value;
        addDonor(logo_url, name, profile, website_url);
      }
      // INITIALIZES A GET REQUEST TO THE API AND FILLS IN THE INFORMATION
      function init() {
        $.ajax({
          type: "GET",
          url: dRoute,
          // crossDomain: true,
          contentType: 'application/json',
          encode: true,
          success: function (data) {
            amnt = data.length;
            data.forEach(function (item) {
              let wrapperId = `${'wrapper'+item.id}`;
              let cancelBtnId = `${'cancel-btn'+item.id}`;
              let fileNameId = `${'file-name'+item.id}`;
              let customBtnId = `${'custom-btn'+item.id}`;
              let defaultBtnId = `${"default-btn"+item.id}`;
              let regExp = /[0-9a-zA-Z\^\&\'\@\{\}\[\]\,\$\=\!\-\#\(\)\.\%\+\~\_ ]+$/;                    
              

              $('#dcont').append(
                `<div class="d-md-flex flex-md-row d-block mb-5">
                  <div class="wrapper" style="width: 200px !important; display: block;" id="${wrapperId}">
                    <div class="editProduct__image" style="width: 100px; height: auto;">
                      <!-- images -->
                      <div class="image" style="width: 100%; height: auto; align-self: center;">
                        <img 
                          src=${item.logo_url}
                          alt="${item.name} image" 
                          style="width: 100%; height: 100%; box-sizing: border-box;"
                          id="${'wrapperImg'+item.id}"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="text-flex px-4" style="width: 480px">
                    <div class="d-block d-md-flex justify-content-between">
                      <h5 class="mb-2" style="text-transform: uppercase">${item.name}</h5>
                      <button type="button" class="btn btn-dark btn-sm mb-2" data-bs-toggle="modal"
                        data-bs-target="${'#profileModal'+item.id}"> <i class="fas fa-edit"></i> Edit ${item.name}
                      </button>
                    </div>
                    <p>${item.profile}</p>
                    <div>
                      <h4 class="mt-2" >Link to works: ${item.website_url}</h4>
                    </div>
                    <button onclick="deleteDonorById(${item.id})" style="float: right">delete</button>
                  </div>
                </div>`
              )
              // CALLING THE MODAL
                
              $('#profileModals').append(
                `<!-- Modal${item.id} -->
                <div class="modal fade" id="${'profileModal'+item.id}" tabindex="-1" 
                  aria-labelledby="${'profileModal'+item.id+'Label'+item.id}" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <div class="container">
                          <div class="signIn-inputs">
                            <form id="${'fileForm'+item.id}" enctype="multipart/form-data">
                              <div class="form-group mb-3">
                                <input type="text" class="form-control mb-3" id="${"name"+item.id}" value="${item.name}">
                              </div>
                              <div class="form-group mb-3">
                                <textarea name="" class="form-control" id="${"profile"+item.id}" cols="30" rows="10">${item.profile}</textarea>
                              </div>
                              <div class="form-group mb-3">
                                <input type="url" class="form-control mb-3" id="${"link"+item.id}" value="${item.website_url}">
                              </div>
                              <div class="form-group mb-3">
                                <button id="${customBtnId}" type="button"
                                  onclick="$('#${defaultBtnId}').click();">
                                  Edit logo
                                </button>
                                <input type="file" id="${"default-btn"+item.id}" onchange="startUpload(this.files[0], ${item.id})" name="file" accept="image/*" style="display: none">
                              </div>
                              <div class=" text-center">
                                <button onclick="Submit(${item.id})" type="button" id="${'submit-btn'+item.id}" class="btn btn-lg btn-modal"
                                  disabled>PUBLISH
                                </button>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>`
              )
            })
          }
        })
      }
      init();
    </script>
</body>

</html>
